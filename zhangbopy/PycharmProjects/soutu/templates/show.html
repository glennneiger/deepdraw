<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>

    <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
    <script src="http://gosspublic.alicdn.com/aliyun-oss-sdk-6.0.1.min.js"></script>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <meta name="referrer" content="no-referrer"/>
    <meta charset="UTF-8">
    <title>深绘搜图</title>
    <style>
        *{
    /* 消除浏览器的影响*/
    margin: 0px;
    padding: 0px;
}
body{
    background: url("http://resources-deepdraw-cn.oss-cn-hangzhou.aliyuncs.com/dp_banner/banner06_bg.jpg");
    /*设置背景图片大小 background-size: 100%;*/
    background-size: 100%;
}
a{
    text-decoration: none;
}
table{
    width: 100%;
    height: 100%;
}
/*顶部导航*/
.nav{
    float:right;
}
.nav td{
    float: left;
    padding: 5px 2px 5px 0px;
}
.nav a{
    font-size: 15px;
    color: #FFFFFF;
}
.nav span{
    font-size: 11px;
    color: #FFFFFF;
}
/*网页logo*/
.logo td{
    text-align: center;
}
.logo img{
    width: 250px;
    margin: 50px 0px 10px 0px ;
}
#table1{
    background-color: #5b8098;
    opacity: 0.8;
}
/*搜索框*/
.search td{
    text-align: center;
    padding: 0px 0px 40px 0px;
}
.search input{
    width: 450px;
    height: 37px;
    /*input和button对不齐 input和button都加上vertical-align:top；*/
    vertical-align: top;

}
.item-if input{
    width: 450px;
    height: 31px;
    /*input和button对不齐 input和button都加上vertical-align:top；*/
    vertical-align: top;
    border-radius: 6px;
}
.search button{
    width: 90px;
    height: 37px;
    font-size: 15px;
    color: #FFFFFF;
    background-color: #38f;
    /*input和button对不齐 input和button都加上vertical-align:top；*/
    vertical-align: top;
    border: #38f;;
}
.item-if button{
    width: 90px;
    height: 31px;
    font-size: 15px;
    color: #FFFFFF;
    background-color: #38f;
    /*input和button对不齐 input和button都加上vertical-align:top；*/
    vertical-align: top;
    border: #38f;;
}
/*图片*/
.table-two{
    width: 674px;
    height: 272px;
    margin: 0 auto;
    /*半透明背景色  background-color:rgba(255,255,255,0.3);*/
    background-color:rgba(255,255,255,0.3);
    padding: 4px 4px 0px 4px;
}

/*脚注*/
.foot td{
    position: fixed;
    bottom: 5px;
    left: 0;
    right: 0;
    text-align: center;
}
.foot a,span{
    color: #FFFFFF;
    font-size: 15px;
    padding: 0px 2px 0px 0px;
}
#tables2{
    text-align: center;
    margin-top: 150px;
}
#logo{
    margin-left: 10%;
    margin-top: 2%;
}

#fonts{
    font-size: 35px;
    color: white;
    margin-bottom: 10px;
}
.upload{
    width:90px;
    height: 37px;
    position: absolute;
    right: 115px;
    font-size: 15px;
    color: #FFFFFF;
    background-color: lightslategray;

}
.upload2{
    width:90px;
    height: 31px;
    position: absolute;
    right: 115px;
    font-size: 15px;
    color: #FFFFFF;
    background-color: lightslategray;

}
.item-ifo{
    position: relative;
    width: 600px;
    height: 40px;
    float: top;
    margin: 0 auto;
}

#fo{
    font-size: 16px;
    vertical-align: center;
    text-align: center;
}
#out{
    text-align: center;
}
/*设置背景图片大小 background-size: 100%;*/
/* margin:0 auto; 与 text-aglin的区别*/
/*底部导航栏   position: fixed;    bottom: 5px;   left: 0;right: 0;*/
/*半透明背景色  background-color:rgba(255,255,255,0.3);*/
/*input和button对不齐 vertical-align:top；*/

        .top {
            height: 10px;
            width: 100%;
            background-color: #858585;
        }

        .menu {
            height: 90px;
            width: 97%;
            margin: 0 auto;
            background-color: rgba(159, 157, 161, 0.8);
        }

        .menu img {
            float: left;
            margin: 11px 70px;
            margin-top: 22px;
        }

        .menu .word {
            float: left;
            color: #ececec;
            font-weight: bolder;
            font-size: 29px;
            margin: 20px 0 0 30%;
        }

        .img_turn {
            overflow: hidden;
            width: 90%;
            margin: -20px auto;
            height: 800px;
            text-align: center;
        }

        .img_turn img {
            width: 100%;
            z-index: 50;
        }

        .img_turn .btn {
            background-color: #1b8ce4;
            margin-top: -180px;
            height: 45px;
            width: 140px;
            padding: auto;
            font-size: 20px;
            border-radius: 10px;
            color: #e4e4e4;
        }

        .img_turn .btn:hover {
            background-color: #146aac;
            font-weight: bolder;
        }

        .result {
            text-align: center;
        }

        .result span {
            color: #fdf9ff;
            font-size: 40px;
            font-weight: bold;
            display: block;
        }

        .result .pic {
            overflow: hidden;
            display: inline-block;
            height: 320px;
            /*width: 20%;*/
            width: 300px;
            margin: 50px 15px 15px 30px;
            position: relative;
        }

        .result .pic .draw_border {
            position: absolute;
            border: 1px solid red;
        }

        .result .pic img {
            vertical-align: center;
            max-width: 100%;
            max-height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .result img {
            max-width: 21%;
            margin-right: 1%;
            margin-bottom: 17px;
        }

        .result .main_pic {
            display: block;
            margin: 30px auto 10px;
        }

        .result .main {
            margin-bottom: 60px;
            font-size: 20px;
            color: #d9d5da;
        }

        .loading {
            position: fixed;
            width: 100%;
            height: 100%;
            background-color: rgba(162, 160, 164, 0.7);
            text-align: center;
            display: none;
        }

        .loading img {
            margin-top: 21%;
            width: 15%;

        }

        .progress {
            margin: 21% 30%;
            width: 38%;
            height: 15px;
        }

        .progress-bar {
            background-color: #8f9398;
        }
        .pict_single{
            position: relative;

            overflow: hidden;
            float: left;
            text-align: center;
            margin: 5px 5px 5px 5px;
        }
        .pict_single img{
            max-width: 350px;
        }
        .pict_single draw_border{
            position: absolute;
            border: 1px solid red;
        }
        .pict2{
            vertical-align: top;
            float: top;
        }
        #all_pict{
            vertical-align: center;
        }
        #main_pic{
            margin:0 auto;
        }
        .item-if {
            position: fixed;
            top: 0%;
            left: 35%;
            width: 565px;
            height: 40px;
            float: top;
            margin: 0 auto;
        }
        .table-two img{
            width: 100%;

}
        .nav_pic{
            width:300px ;
            height: 450px;
            margin: 2px 2px 2px 2px;
            overflow: hidden;
        }
        #loadings{
            position: absolute;
            text-align: center;
            vertical-align: center;

        }
        #loadings img{
            margin-top: 310px;
        }
        #main_pic{
            margin: 0 auto;
        }
        </style>
</head>
<body>
<div id="loadings" style="display: none;width: 100%;height: 200%;background-color: #072734">
    <img src="http://img.lanrentuku.com/img/allimg/1609/5-160914192R3.gif"/>
</div>
<div class="loading">
    <!--<img src="https://dbr-cd.oss-cn-hangzhou.aliyuncs.com/pic/15%20%282%29.gif?Expires=1565231277&OSSAccessKeyId=TMP.hVf9vZfjaf37YXiyM19Y4RTmELNkJgV7fEjsnUC5Ppa5wjDbAZ9kL9pK5Z9AA2rG1Vxx9YAr7Z86oSkVztMrzpZLQEGjJ6FLUvetWqzFEqacZ47DLFmoePyFi3AEFT.tmp&Signature=zBWQrbyYZg%2B8yiQoPfVwKRezQWU%3D" alt="正在加载">-->
    <div class="progress progress-striped active">
        <div class="progress-bar progress-bar-success" role="progressbar"
             aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
             style="width: 0%;">
        </div>
    </div>
</div>
<div id="else">
<div id="table1">
<table class="table-one">
    <div id="navs">
    <tr class="nav">
        <td><a href="http://www.deepdraw.cn/#/">&nbsp;收藏本页&nbsp;</a></td>
        <td><span>|</span></td>
        <td><a href="http://www.deepdraw.cn/#/">&nbsp;深绘首页&nbsp;</a></td>
        <td><span>|</span></td>
        <td><a href="http://www.deepdraw.cn/#/">&nbsp;深绘APP&nbsp;</a></td>
        <td><span>|</span></td>
        <td><a href="http://www.deepdraw.cn/#/">&nbsp;登录&nbsp;</a></td>
        <td><span>&nbsp;</span></td>
        <td><a href="http://www.deepdraw.cn/#/">&nbsp;注册&nbsp;</a></td>
    </tr>
</div>
</table>
    </div>
    <div id="logo">
        <a href="http://192.168.3.103:8080/result/show/"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGEAAAAVCAYAAABWtYB0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowOTYyNjM2NDFDMEIxMUU3OEZFM0I3NThDMEQ2MTRBOSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowOTYyNjM2NTFDMEIxMUU3OEZFM0I3NThDMEQ2MTRBOSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjA5NjI2MzYyMUMwQjExRTc4RkUzQjc1OEMwRDYxNEE5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjA5NjI2MzYzMUMwQjExRTc4RkUzQjc1OEMwRDYxNEE5Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+bKpiOAAABa5JREFUeNqsWX1MllUU54WXVwi1ucQSE8HhjGY6l6S2aDUtcxNpZVKYWZJtlZbpxlYtU5e6/gt1ETodtTbTxixj9jH6soKcjDbWl1+gBYWWvimIHy/wdC773e3s7N7n4+U522/vc+/5nXue5577ce59I47jpIQkrxBWEzIC2Fwk3OzBKSJ8aajvIkwmqA/YQniWkDrEbzhNmIo2tbQQCgzcMsKnhJWE1wnDkvB3iXBHJKQgqA54Owm7dsJED04z4XaLLkKYQDgV0kBSnTKCBeFOwg8W7jTCL4S+Ifp8IxrSy29K0m6XD84+Qr2h/mv8rhKzYydhwKf/TMJaQhrzxUdlBXs+xHxeILQSFoj2qglnffh9hjAWz/emqJnggREWZEN/l2OWK4Q+4DLhgoFzkw//XjjD2stLwr6P2c9i9WmEbqa70WBbxfS1AXw+xuyOuhGXEtoIFw1QHfwSeLWiY3cTJiFI44DRhJWC920IAZjD2jtJyIK/AkLEYjOcMB7vt53Znxa8h5juJ0tbXYwz3eJnnMAYwjxm95ft4wocb9Ejo5fVdbh0WJ2wXxpCEPaw9nqBfnSaLQinwL8q3meD4B1kuncM7dzH9O1CF0FQHbwPxzWsDFrO2T5up0cAPgCvRNSvt7SXK3iqAzKGGIA8l/d7zWLznItNPuONErpFhrZ+Zvp1Qve8E0CiloyjzFB/DbrvCEtQ96Lg1Fs2ortF+SPCFY/NazGhhJBAOYrspRqbYjphPdJcLanYWLer1A/pYwqymDcJbUilue8YNvR2VreEPXcT9hv6qAYb+4AhwThu8GOS6OD7GyIsR/cxQjGWH76R3iB4aoO7zjICtwnuXI9RnukycF71OVOamM3qgLOsxWWUhw7TTFghygsJvxt45aKsDi69lohzbpzQ4DFCZqCtcxhpE5iujo2iQuTpPK3sJ+QQZrEZ3ISDXYTx0mB7AjZa8gjTWfkEbDsJPay+EO0NJJGaR+C/g/CfjEqOGHVNLhE8KbjFPtIx0wZoy2D0nrGb2TYyzn4nHKkUvncJfQK/BxinNCTfrYOHZfECGwSpzNJJxYLX5tKhRwR3dMDpyjOJEtSNdcKTUuZrpAtvC+M1h+S7zrQcLWPPl7GBmuRpUa618HKxtGj5hvBvgGm7md1FqZPoJ3iuZJw/CY9gWVDL0mzCVrGcdrINXi9FmahrFkvZPVgK1bK0F0uHWoY2gnMLu0aJo/2rYqnTMgAd34jTWULQMvjEolskovSuZWTGCD2Cm2vhrhO8xwPOAp7LL0fd9WyJUPKksNnMdN8PYcPcytrZa1kG3w9jY+aFGtFhFRajWwXvRxcHbeIaI8jZ4Alm28nqn2L1/wibYfAjAzQJ6+9hLCVqGUh18T1TfKO+zpjscx/UyIY/7bfKLQgRw91OvqXhNYK3wsKbInh7AgQgJt5nDtP9yurLhV252FCzUJ9umL05Lv7/YLwPWX0jqz/k81uOC78xWxAWCmKDpcFphPOM14/LPMkbheg7lo70Qj2z28fqX2D1vxnsvrJ0nsIm8T5TLL6rxclen30eFvYTfX7LKmFXaAvCAUFsxwXbYaDRkOUo+Zg19jJ4Kq2NC15HgABUMjvVThT1Y0SbU4WdzJjmCf1ioS8y+L5NcBagPkNkaRUBvme8aHO26bA20nAvngd4SRV+dxgOeVyafGZDi3C9oOV+9qfJQeG3Vdjyq4bzhM+F/m9RThPl4YTPWPktdg2zkWVp6hrjDOFBH//kqewr3/OrMYKTkbiPizRbBmPCo8Jmh+UA1WWxb2CcbQa9/N9jhrhgPGtZjuc74YpxJjyA6AaRY+yssAwXVQkDrwf/VtV6tFdKeA95usrRv8C/T3p2LEdbCfFvl5YszNxu5OY1Bk5MfGecnWXUO2ZDf4QwF7p8XM4lxGWcPl85Pq4nHHYtoq4pjkrS/wIMAPiAdiPO9/6/AAAAAElFTkSuQmCC" width="97px" height="21px" /></td>
            </a>
    </div>
    <div id="tables2">
<table>
        <tr class="logo">
        <td colspan="9" id="foo"><p id="fonts">以&nbsp&nbsp&nbsp图&nbsp&nbsp&nbsp搜&nbsp&nbsp&nbsp图</p></td>
    </tr>
    <tr class="search">
        <td colspan="9">
            <div id="out">
            <div class="item-ifo">
                <div class="upload">

                <label class="btn" for="input_img"><p id="fo">上传图片</p></label>

                <input type="file" accept="image/gif,image/jpeg,image/jpg,image/png" id="input_img" style="display: none">

                </div>
            <input type="text" name="searchs" id="get_input" placeholder="请输入图片url"/><button onclick="sendurl()" id="click">搜索一下</button>

                <div class="ico"></div>
                </div>
                </div>
        </td>
    </tr>
    <tr class="picture">
        <td colspan="9">
            <table class="table-two">
                <tr>
                    <td><div class="nav_pic"><img src="http://deepdraw-test.oss-cn-hangzhou.aliyuncs.com/soutu/4b180eb4-0ecf-4018-88d8-e59d919dd603.jpg" /></div></td>
                    <td><div class="nav_pic"><img src="http://deepdraw-test.oss-cn-hangzhou.aliyuncs.com/soutu/b5a0e89a-9508-4326-84dd-a095a9543a67.jpg" /></div></td>
                    <td><div class="nav_pic"><img src="http://deepdraw-test.oss-cn-hangzhou.aliyuncs.com/soutu/5e801db8-769e-4d9b-8643-bb7bac012567.jpg" /></div></td>
                    <td><div class="nav_pic"><img src="http://deepdraw-test.oss-cn-hangzhou.aliyuncs.com/soutu/cc8ceba5-5583-41dd-afb6-b09b948ba46f.jpeg" /></div></td>
                </tr>
            </table>
        </td>

    </tr>


</table>
    </div>

<div id="all_pict" style="margin-left: 2.8%;">
<div class="result">
</div>
</div>

<div class="item-if" style="display: none">

    <div class="upload2">
    <label class="btn" for="input_img" id="ches"><p id="fo">上传图片</p></label>

    <input type="file" accept="image/gif,image/jpeg,image/jpg,image/png" id="input_img" style="display: none">
    </div>
    <input type="text"  id="get_inputs" placeholder="请输入图片url" /><button onclick="sendurl()">搜索一下</button>
    </div>
    </div>
<script type="text/javascript">
        $(".nav_pic img").click(function(){
            let a=$(this).attr("src");
            $('#get_input').val(a);
            $("#click").click();
        });


        function uuid() {
            var s = [];
            var hexDigits = "0123456789abcdef";
            for (var i = 0; i < 36; i++) {
                s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
            }
            s[14] = "4"; // bits 12-15 of the time_hi_and_version field to 0010
            s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01
            s[8] = s[13] = s[18] = s[23] = "-";

            var uuid = s.join("");
            return uuid;
        }


        function sendurl() {
            $('#loadings').css("display", "block");
            $('#else').css("display", "none");
            var url1 = document.getElementById("get_input").value;
            var url2=  document.getElementById("get_inputs").value;
            if (url1.length>1){
                var url =  url1;
            }else{
                url = url2;
            }
            console.log(url);
            var main_url=url;
            axios.post('/result/get_feature/', {     //部署时需要修改post目标地址
                //post传参
                url: url,
            }).then(function (response) {
                $('.result').empty();
                if (response.data.code == 1) {
                    var url_list = response.data.url_list;
                    var body_info = response.data.body_info;
                    //var search_url =document.getElementById("get_input").value;
                    //console.log(search_url);
                    if (url_list.length > 0) {
                        $('#loadings').css("display", "none");
                        $('#else').css("display", "block");
                        append_main = '<span>搜 图 结 果</span>\n' +
                            '<div class="pic">\n' +
                            '        <img src="' + main_url + '" alt="主图"  id="main_pic" class="pict1" >\n' +
                            '        <span class="draw_border" id="border"></span>\n' +
                            '    </div>' +
                            '    <span class="compare">匹配图</span>';
                        $('.result').append(append_main);
                        t = body_info["t"];
                        r = body_info["r"];
                        b = body_info["b"];
                        l = body_info["l"];
                        console.log(url_list.length);
                        $('#tables2').css("display", "none");
                        $('.item-if').css("display", "block");
                        draw_region_main(t, r, b, l);
                        for (var i = 0; i < url_list.length; i++) {
                            var urls = url_list[i];
                            append_content = '<div class="pict_single">\n' +
                                '<img src="' + urls + '" alt="相似图片" height="350px" id="img" class="pict2">\n' +
                                '</div>';
                            $('.result').append(append_content);
                        }

                    } else {
                        $('#loadings').css("display", "none");
                        $('#else').css("display", "block");
                        append_content = '<span> 无 匹 配 信 息</span>';
                        $('.result').append(append_content);
                    }
                } else {
                    alert(response.data.result)
                }
            });

        }

        function randomNum(minNum, maxNum) {
            switch (arguments.length) {
                case 1:
                    return parseInt(Math.random() * minNum + 1, 10);
                    break;
                case 2:
                    return parseInt(Math.random() * (maxNum - minNum + 1) + minNum, 10);
                    break;
                default:
                    return 0;
                    break;
            }
        }

        function sleep(delay) {
            var start = (new Date()).getTime();
            while ((new Date()).getTime() - start < delay) {
                continue;
            }
        }

        function fadeOut() {
            op = 1;
            timer1 = setInterval(function () {
                $('.loading').css('opacity', op);
                if (op <= 0) {
                    clearInterval(timer1)
                }
                op -= 0.1;
            }, 100);
        }

        function draw_region_main(t, r, b, l) {
            var width;
            var height;
            $("img").on("load", function () {
                width = $('#main_pic').width();
                height = $('#main_pic').height();
                //console.log(X, Y);
                $("#border").width(width * (r - l)).height(height * (b - t));
                $("#border").css({'top': height * t + "px", 'left': width * l + "px"});
            });
            $(window).resize(function () {
                width = $('#main_pic').width();
                height = $('#main_pic').height();
                //console.log(X, Y);
                $("#border").width(width * (r - l)).height(height * (b - t));
                $("#border").css({'top': height * t + "px", 'left': width * l + "px"});
            });
        }

        function draw_region(t, r, b, l, picid) {
            var width;
            var height;
            $("#img" + picid).on("load", function () {
                width = $('#img' + picid).width();
                height = $('#img' + picid).height();
                console.log(width, height);
                $("#border" + picid).width(width * (r - l)).height(height * (b - t));
                $("#border" + picid).css({'top': height * t + "px", 'left': width * l + "px"});
            });
            $(window).resize(function () {
                width = $('#img' + picid).width();
                height = $('#img' + picid).height();
                //console.log(X, Y);
                $("#border" + picid).width(width * (r - l)).height(height * (b - t));
                $("#border" + picid).css({'top': height * t + "px", 'left': width * l + "px"});
            });
        }

        $(function () {
            $('#input_img').change(function () {

                $('.progress-bar').css('width', '0%');
                $('.loading').css('opacity', '1');
                $('.result').empty();
                $('.loading').css('display', 'block');
                var urls = $(document).ready(function () {
                    $("img").click(function () {
                        var url = $(this).attr("src");
                        var main_url = url;
                        return url;
                    });
                });
                console.log(urls);
                var width = 0;
                timer = setInterval(function () {
                    width += randomNum(0, 7);
                    $('.progress-bar').css('width', width + '%');
                    console.log(width);
                    if (width >= 100) {
                        clearInterval(timer)
                    }
                }, randomNum(70, 150));
                console.log(document.getElementById("input_img").files[0]);
                let file = document.getElementById("input_img").files[0];
                let client = new OSS({
                    accessKeyId: 'LTAI4VIH8rP2cjtg',
                    accessKeySecret: 'uzXZC3TB4egoT5FZe0nYn1BsoqXo5x',
                    //stsToken: result.SecurityToken,
                    endpoint: 'oss-cn-hangzhou.aliyuncs.com',
                    bucket: 'deepdraw-test',
                });
                var spstr = $('#input_img').val().split('.');
                var storeAs = 'soutu/' + uuid() + '.' + spstr[spstr.length - 1];
                //console.log(storeAs);
                client.multipartUpload(storeAs, file).then(function (result) {
                    console.log(result);
                    if (result.res.requestUrls[0].split('?')[0].length > 0) {
                        url = result.res.requestUrls[0].split('?')[0];
                        main_url = url;
                    } else {
                        url = $("#get_inputs").val();
                        main_url = url;
                        console.log(url)
                    }

                        //console.log(url);
                        axios.post('http://192.168.3.103:8080/result/get_feature/', {     //部署时需要修改post目标地址
                            //post传参
                            url: url,
                        }).then(function (response) {
                            if (response.data.code == 1) {
                                var url_list = response.data.url_list;
                                var body_info = response.data.body_info;
                                //var search_url =document.getElementById("get_input").value;
                                //console.log(search_url);
                                if (url_list.length > 0) {
                                    append_main = '<span>搜 图 结 果</span>\n' +
                                        '<div class="pic">\n' +
                                        '        <img src="' + main_url + '" alt="主图"  id="main_pic" class="pict1" >\n' +
                                        '        <span class="draw_border" id="border"></span>\n' +
                                        '    </div>' +
                                        '    <span class="compare">匹配图</span>';
                                    $('.result').append(append_main);
                                    t = body_info["t"];
                                    r = body_info["r"];
                                    b = body_info["b"];
                                    l = body_info["l"];
                                    console.log(url_list.length);
                                    $('#tables2').css("display", "none");
                                    $('.item-if').css("display", "block");
                                    draw_region_main(t, r, b, l);
                                    for (var i = 0; i < url_list.length; i++) {
                                        var url = url_list[i];
                                        append_content = '<div class="pict_single">\n' +
                                            '<img src="' + url + '" alt="相似图片" height="450px" id="img" class="pict2">\n' +
                                            '</div>';
                                        $('.result').append(append_content);
                                    }

                                } else {
                                    append_content = '<span> 无 匹 配 信 息</span>';
                                    $('.result').append(append_content);
                                }
                            } else {
                                alert(response.data.result)
                            }
                            if (width < 107) {
                                clearInterval(timer);
                                $('.progress-bar').css('width', '100%');
                                setTimeout(function () {
                                    $('.progress-bar').css('width', '100%');
                                    //$('.loading').css('display', 'none');
                                }, 2000);
                                var op = 1;
                                timer1 = setInterval(function () {
                                    $('.loading').css('opacity', op);
                                    if (op <= 0) {
                                        clearInterval(timer1);
                                        $('.loading').css('display', 'none');
                                    }
                                    op -= 0.1;
                                }, 100);
                            } else {
                                clearInterval(timer);
                                $('.progress-bar').css('width', '100%');
                                timer1 = setInterval(function () {
                                    $('.loading').css('opacity', op);
                                    if (op <= 0) {
                                        clearInterval(timer1);
                                        $('.loading').css('display', 'none');
                                    }
                                    op -= 0.1;
                                }, 100);
                            }
                        }).catch(function (error) {
                            console.log(error)
                        })
                    }).catch(function (error) {
                        console.log(error);
                    })
                });
            });



</script>
</body>
</html>
