<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>搭配</title>
    <link rel="stylesheet"
          href="https://deepdraw-dbr.oss-cn-hangzhou.aliyuncs.com/web/soutu_menu/facesearch/soutunew/static/css/search.css">
    <script type="text/javascript" src="http://dbr.deepdraw.cn/web/duichang/static/spark_md5.js"></script>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/vue/2.2.2/vue.min.js"></script>
    <script src="http://gosspublic.alicdn.com/aliyun-oss-sdk-6.0.1.min.js"></script>
    <script src="https://cdn.staticfile.org/axios/0.18.0/axios.min.js"></script>
    <script src="http://funkydog.oss-cn-chengdu.aliyuncs.com/static/element.js"></script>
    <link rel="stylesheet" href="http://funkydog.oss-cn-chengdu.aliyuncs.com/static/element.css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
</head>
<body>
<div>
    <div id="all">
        <div id="top_nav">
            <div id="logo">
                <a href="http://dbr.deepdraw.cn/web/soutu_menu/facesearch/soutunew/soutunew.html">
                    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGEAAAAVCAYAAABWtYB0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowOTYyNjM2NDFDMEIxMUU3OEZFM0I3NThDMEQ2MTRBOSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowOTYyNjM2NTFDMEIxMUU3OEZFM0I3NThDMEQ2MTRBOSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjA5NjI2MzYyMUMwQjExRTc4RkUzQjc1OEMwRDYxNEE5IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjA5NjI2MzYzMUMwQjExRTc4RkUzQjc1OEMwRDYxNEE5Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+bKpiOAAABa5JREFUeNqsWX1MllUU54WXVwi1ucQSE8HhjGY6l6S2aDUtcxNpZVKYWZJtlZbpxlYtU5e6/gt1ETodtTbTxixj9jH6soKcjDbWl1+gBYWWvimIHy/wdC773e3s7N7n4+U522/vc+/5nXue5577ce59I47jpIQkrxBWEzIC2Fwk3OzBKSJ8aajvIkwmqA/YQniWkDrEbzhNmIo2tbQQCgzcMsKnhJWE1wnDkvB3iXBHJKQgqA54Owm7dsJED04z4XaLLkKYQDgV0kBSnTKCBeFOwg8W7jTCL4S+Ifp8IxrSy29K0m6XD84+Qr2h/mv8rhKzYydhwKf/TMJaQhrzxUdlBXs+xHxeILQSFoj2qglnffh9hjAWz/emqJnggREWZEN/l2OWK4Q+4DLhgoFzkw//XjjD2stLwr6P2c9i9WmEbqa70WBbxfS1AXw+xuyOuhGXEtoIFw1QHfwSeLWiY3cTJiFI44DRhJWC920IAZjD2jtJyIK/AkLEYjOcMB7vt53Znxa8h5juJ0tbXYwz3eJnnMAYwjxm95ft4wocb9Ejo5fVdbh0WJ2wXxpCEPaw9nqBfnSaLQinwL8q3meD4B1kuncM7dzH9O1CF0FQHbwPxzWsDFrO2T5up0cAPgCvRNSvt7SXK3iqAzKGGIA8l/d7zWLznItNPuONErpFhrZ+Zvp1Qve8E0CiloyjzFB/DbrvCEtQ96Lg1Fs2ortF+SPCFY/NazGhhJBAOYrspRqbYjphPdJcLanYWLer1A/pYwqymDcJbUilue8YNvR2VreEPXcT9hv6qAYb+4AhwThu8GOS6OD7GyIsR/cxQjGWH76R3iB4aoO7zjICtwnuXI9RnukycF71OVOamM3qgLOsxWWUhw7TTFghygsJvxt45aKsDi69lohzbpzQ4DFCZqCtcxhpE5iujo2iQuTpPK3sJ+QQZrEZ3ISDXYTx0mB7AjZa8gjTWfkEbDsJPay+EO0NJJGaR+C/g/CfjEqOGHVNLhE8KbjFPtIx0wZoy2D0nrGb2TYyzn4nHKkUvncJfQK/BxinNCTfrYOHZfECGwSpzNJJxYLX5tKhRwR3dMDpyjOJEtSNdcKTUuZrpAtvC+M1h+S7zrQcLWPPl7GBmuRpUa618HKxtGj5hvBvgGm7md1FqZPoJ3iuZJw/CY9gWVDL0mzCVrGcdrINXi9FmahrFkvZPVgK1bK0F0uHWoY2gnMLu0aJo/2rYqnTMgAd34jTWULQMvjEolskovSuZWTGCD2Cm2vhrhO8xwPOAp7LL0fd9WyJUPKksNnMdN8PYcPcytrZa1kG3w9jY+aFGtFhFRajWwXvRxcHbeIaI8jZ4Alm28nqn2L1/wibYfAjAzQJ6+9hLCVqGUh18T1TfKO+zpjscx/UyIY/7bfKLQgRw91OvqXhNYK3wsKbInh7AgQgJt5nDtP9yurLhV252FCzUJ9umL05Lv7/YLwPWX0jqz/k81uOC78xWxAWCmKDpcFphPOM14/LPMkbheg7lo70Qj2z28fqX2D1vxnsvrJ0nsIm8T5TLL6rxclen30eFvYTfX7LKmFXaAvCAUFsxwXbYaDRkOUo+Zg19jJ4Kq2NC15HgABUMjvVThT1Y0SbU4WdzJjmCf1ioS8y+L5NcBagPkNkaRUBvme8aHO26bA20nAvngd4SRV+dxgOeVyafGZDi3C9oOV+9qfJQeG3Vdjyq4bzhM+F/m9RThPl4YTPWPktdg2zkWVp6hrjDOFBH//kqewr3/OrMYKTkbiPizRbBmPCo8Jmh+UA1WWxb2CcbQa9/N9jhrhgPGtZjuc74YpxJjyA6AaRY+yssAwXVQkDrwf/VtV6tFdKeA95usrRv8C/T3p2LEdbCfFvl5YszNxu5OY1Bk5MfGecnWXUO2ZDf4QwF7p8XM4lxGWcPl85Pq4nHHYtoq4pjkrS/wIMAPiAdiPO9/6/AAAAAElFTkSuQmCC">
                </a>
            </div>
            <div id="nav_select">
                <el-menu
                        :default-active="5"
                        class="el-menu-demo"
                        mode="horizontal"
                        background-color="rgb(47,52,61)"
                        text-color="#fff"
                        active-text-color="#66b1ff">
                    <el-menu-item index="1"><a
                            href="http://dbr.deepdraw.cn/web/soutu_menu/facesearch/soutunew/soutunew.html">搜图主页</a>
                    </el-menu-item>
                    <el-menu-item index="3"><a href="http://dbr.deepdraw.cn/web/soutu_menu/facemerge/facemerge.html">人脸融合</a>
                    </el-menu-item>

                    <el-menu-item index="4"><a
                            href="http://dbr.deepdraw.cn/web/soutu_menu/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/contentSearch.html">文本分类</a>
                    </el-menu-item>
                    <el-menu-item index="5"><a
                            href="">搭配</a>
                    </el-menu-item>
                    <el-submenu index="2">
                        <template slot="title">我的</template>
                        <el-menu-item index="2-1">选项1</el-menu-item>
                        <el-menu-item index="2-2">选项2</el-menu-item>
                        <el-menu-item index="2-3">选项3</el-menu-item>
                        <el-submenu index="2-4">
                            <template slot="title">选项4</template>
                            <el-menu-item index="2-4-1">选项1</el-menu-item>
                            <el-menu-item index="2-4-2">选项2</el-menu-item>
                            <el-menu-item index="2-4-3">选项3</el-menu-item>
                        </el-submenu>
                    </el-submenu>
                </el-menu>
            </div>
        </div>
        <div id="search2">
            <div class="upload">
                <button>
                    <label class="btn" for="input_imgs"><p id="fo">上传图片</p></label>
                </button>
                <input type="file" accept="image/gif,image/jpeg,image/jpg,image/png" id="input_imgs"
                       style="display: none;" v-on:input="upload">
            </div>
        </div>
        <div id="result_page">
            <div id="left_box">
                <el-card shadow="hover" style="height: 796px">
                    <div id="main_pic">
                        <div id="tipp">
                            <p>商品图片</p>
                        </div>
                        <img v-bind:src="main_url" alt="fail" class="main_imgs">
                        <div class="boxs">
                            <div v-bind:class="box[4]" v-bind:id="box[4]+'box'"
                                 v-bind:style="{display:'none',position:'absolute',border:'1px solid red',width:box[0]+'px',height:box[1]+'px',top:box[2]+45+'px',left:box[3]+'px'}"
                                 style="z-index: 10">
                            </div>
                        </div>
                    </div>
                </el-card>
            </div>
            <div id="right_box">
                <el-card>
                    <template>
                        <el-tabs v-model="activeName" type="card" @tab-click="handleClick">
                            <el-tab-pane label="所有图片" name="first" v-loading="loading"
                                         element-loading-text="拼命加载中
                                预计耗时10秒"
                                         element-loading-spinner="el-icon-loading"
                                         element-loading-background="rgba(64,158,255, 0.3)"
                                         style="width: 100%;height: 700px;overflow-y: scroll;">
                                <div class="wall">
                                    <div style="margin-left: 30px;">
                                        <div id="a" style="float: left;">
                                            <div v-for="data1 in result_position_lista" class="a">
                                                <div class="pict_single wrap">
                                                    <a v-bind:href="data1[5]"
                                                       target="_blank">
                                                        <img v-bind:src="data1[0]" class="pict"
                                                             referrerPolicy="no-referrer" width="100%">
                                                        <span class="draw_border"
                                                              v-bind:style="{position:'absolute',border:'1px solid red',width:data1[1]+'px',height:data1[2]+'px',top:data1[3]+'px',left:data1[4]+'px'}"></span>
                                                        <span class="top common"></span>
                                                        <span class="right common"></span>
                                                        <span class="bottom common"></span>
                                                        <span class="left common"></span>
                                                    </a>
                                                    <span class="distance" style="text-align: center">
                                                        <p>{{ data1[6] }}</p>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="b" style="float: left;">
                                            <div v-for="data2 in result_position_listb" class="b">
                                                <div class="pict_single wrap">
                                                    <a v-bind:href="data2[5]"
                                                       target="_blank">
                                                        <img v-bind:src="data2[0]" class="pict"
                                                             referrerPolicy="no-referrer" width="100%">
                                                        <span class="draw_border"
                                                              v-bind:style="{position:'absolute',border:'1px solid red',width:data2[1]+'px',height:data2[2]+'px',top:data2[3]+'px',left:data2[4]+'px'}"></span>
                                                        <span class="top common"></span>
                                                        <span class="right common"></span>
                                                        <span class="bottom common"></span>
                                                        <span class="left common"></span>
                                                    </a>
                                                    <span class="distance" style="text-align: center">
                                                        <p>{{ data2[6] }}</p>
                                                    </span>

                                                </div>
                                            </div>
                                        </div>
                                        <div id="c" style="float: left">
                                            <div v-for="data3 in result_position_listc" class="c">
                                                <div class="pict_single wrap">
                                                    <a v-bind:href="data3[5]"
                                                       target="_blank">
                                                        <img v-bind:src="data3[0]" class="pict"
                                                             referrerPolicy="no-referrer" width="100%">
                                                        <span class="draw_border"
                                                              v-bind:style="{position:'absolute',border:'1px solid red',width:data3[1]+'px',height:data3[2]+'px',top:data3[3]+'px',left:data3[4]+'px'}"></span>
                                                        <span class="top common"></span>
                                                        <span class="right common"></span>
                                                        <span class="bottom common"></span>
                                                        <span class="left common"></span>
                                                    </a>
                                                    <span class="distance" style="text-align: center">
                                                        <p>{{ data3[6] }}</p>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </el-tab-pane>
                            <el-tab-pane label="ins图片" name="second">暂无</el-tab-pane>
                        </el-tabs>
                    </template>
                </el-card>
            </div>
        </div>
    </div>
</div>
<script>
    new Vue({
        el: '#all',
        data: {
            main_url: 'http://deepdraw-dbr.oss-cn-hangzhou.aliyuncs.com/element/%E7%B4%A0%E6%9D%90/015b1456cd26db32f7a84.jpg%401280w_1l_2o_100sh.jpg',
            box: [],
            activeName: 'first',
            loading: false,
            result_position_lista: [],
            result_position_listb: [],
            result_position_listc: [],
            resVector: '',
            resPics: '',
            apiVector: 'http://192.168.2.104:5001/cloth_recom/',
            apiPics: "",
            imageVector: [],
            box: [],
            clothType: '',
        },
        methods: {
            upload: function () {
                //用户上传图片至oss
                console.log('用户上传图片');
                var file2 = document.getElementById("input_imgs").files[0];
                console.log(file2);
                var file = file2;
                let spark = new SparkMD5();
                var codes = spark.code();
                let client = new OSS({
                    accessKeyId: codes.hs,
                    accessKeySecret: codes.ah,
                    endpoint: 'oss-cn-hangzhou.aliyuncs.com',
                    bucket: 'deepdraw-dbr',
                });
                var file_types = file['name'].split('.');
                var file_type = file_types[file_types.length - 1];
                var storeAs = 'soutu_data/upload_imgs/' + this.uuid() + '.' + file_type;
                client.multipartUpload(storeAs, file)
                    .then((result) => {
                        if (result.res.requestUrls[0].split('?')[0].length > 0) {
                            this.main_url = result.res.requestUrls[0].split('?')[0];
                        } else {
                            this.main_url = 'wrong';
                        }
                        ;
                        this.$options.methods.postUrl(this);
                    })
            },

            uuid: function () {
                //随机生成uuid
                //console.log('计算uuid');
                var s = [];
                var hexDigits = "0123456789abcdef";
                for (var i = 0; i < 36; i++) {
                    s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
                }
                s[14] = "4"; // bits 12-15 of the time_hi_and_version field to 0010
                s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1); // bits 6-7 of the clock_seq_hi_and_reserved to 01
                s[8] = s[13] = s[18] = s[23] = "-";
                var uuid = s.join("");
                return uuid;
            },

            handleClick: function (tab, event) {
                //选择结果页面的标签
                console.log("点击事件");
            },

            postUrl: function (thi) {
                console.log(thi.main_url);
                axios.get(thi.apiVector + '?str={"path":"' + thi.main_url + '"}').then((response) => {
                    console.log(response.data);
                    thi.imageVector = response.data[0];
                    thi.box = response.data[1].split(' ');
                    console.log(thi.box);
                    thi.clothType = response.data[2].slice(2, response.data[2].length - 1);
                    console.log(thi.clothType);
                    let resdata = thi.$options.methods.esSearch(thi);

                });
            },

            esSearch: function (th) {
                console.log(th.imageVector.length);
                let test_body = {
                    "size": 10,
                    "query": {
                        "script_score": {
                            "query": {
                                "bool": {
                                    "filter": {
                                        "term": {
                                            "status": "published"
                                        }
                                    }
                                }
                            },
                            "script": {
                                "source": "1 / (1 + l2norm(params.queryVector, doc['image_vector']))",
                                "params": {
                                    "queryVector": th.imageVector
                                }
                            }
                        }
                    }
                };
                console.log(test_body);
                var instance = axios.create({
                    baseURL: "http://192.168.2.104:9200",
                    withCredentials: true
                });
                axios.get("http://192.168.2.109:9200/test_lp/employee/_search",{withCredentials: true})
                    .then((res) => {
                        console.log(res);
                    });

                axios.get("http://192.168.2.104:9200/zy_test/_search", test_body, {withCredentials: true})
                    .then((res) => {
                        console.log(res);
                    });
                return 1;
            }

        }
    });
</script>
</body>
</html>